#!/bin/sh

# shellcheck source=bin/dotlib
. "$(dirname "$(realpath "$0")")/dotlib"

# Keep the system awake while Time Machine is backing up
# (used by the launch agent `engineering.dom.up-for-time-machine`)
tmutil_is_running() {
  tmutil status | grep -q "Running = 1"
}

keep_awake() {
  __log "Keeping the system awakeâ€¦"
  __dotfiles_bin up -t 60
}

if ! tmutil_is_running; then
  exit 0
fi

__log "Time Machine is running."
keep_awake

while tmutil_is_running; do
  keep_awake
done

__log "Time Machine is done."
__log
