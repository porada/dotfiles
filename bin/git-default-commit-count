#!/bin/sh

# shellcheck source=bin/dotlib
. "$(dirname "$(realpath "$0")")/dotlib"

# Returns the number of the last available commits
# that can be used as a consistent default
default=10
count=0

# Ensure the repository has a `HEAD` first
if git rev-parse --verify HEAD > /dev/null 2>&1; then
  count=$(git rev-list --count HEAD)
fi

if [ "${1-}" = "--no-initial" ] && [ "$count" -gt 0 ]; then
  count=$((count - 1))
fi

echo $((count < default ? count : default))
