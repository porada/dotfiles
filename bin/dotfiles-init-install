#!/bin/sh

# shellcheck source=bin/dotlib
. "$(dirname "$(realpath "$0")")/dotlib"

__print_heading 'Installing dependencies through `brew`'

brew analytics off

for formula in fish git node@22 pnpm shellcheck vim; do
  __print_heading_dimmed "Installing \`$formula\`"

  if ! brew list --formula | grep -q "^$formula\$"; then
    brew install $formula
  else
    brew unlink $formula
    brew link --overwrite $formula
  fi
done

# Set `fish` as the default shell
fish="$(brew --prefix)/bin/fish"
[ "$fish" = "$SHELL" ] && exit 0

__print_heading 'Setting up `fish` as the default shell'

grep -qx "$fish" /etc/shells || echo "$fish" | sudo tee -a /etc/shells
chsh -s "$fish"

"$fish" --init-command="dotfiles-dependencies"
