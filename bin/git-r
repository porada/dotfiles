#!/bin/sh

# Enable strict mode
set -eu

# Rebase a given number of last commits
count="${1:-$(git default-commit-count --no-initial)}"
available=0

# Ensure the repository has a `HEAD` first
if git rev-parse --verify HEAD > /dev/null 2>&1; then
  available=$(git rev-list --count HEAD)
fi

# Account for the initial commit
if [ "$available" -gt 0 ]; then
  available=$((available - 1))
fi

if [ "$available" -le 0 ] || [ "$count" -le 0 ]; then
  echo "No commits to rebase"
  exit 0
fi

if [ "$count" -gt "$available" ]; then
  count="$available"
fi

git rebase --interactive "HEAD~$count"
