#!/bin/sh

# shellcheck source=bin/dotlib
. "$(dirname "$(realpath "$0")")/dotlib"

__print_heading "Linking all dotfiles"

for source in .config/fish .gitconfig .hushlogin .local .npmrc .ssh .vim .vimrc; do
  __symlink "$DOTFILES/$source" "$HOME/$source"
done

__print_heading_dimmed "Provisioning extra files"

touch "$DOTFILES_FISH_DIR/extra.fish"
touch "$HOME/.local/.aiexclude"
touch "$HOME/.node_history"
touch "$HOME/.ssh/.aiexclude"
mkdir -p "$HOME/Projects"

__print_heading_dimmed "Ensuring consistent permissions"

__chmod "$DOTFILES"
__chmod "$DOTFILES_FISH_DIR/extra.fish"
__chmod "$HOME/.node_history"
__chmod "$HOME/Projects"

# Ensure Apple Keychain includes the SSH key
SSH_KEY="$HOME/.ssh/id_ed25519"

if [ -f "$SSH_KEY" ]; then
  __print_heading "Linking the SSH key to Apple Keychain"
  __ssh_add --apple-use-keychain "$SSH_KEY"
fi
