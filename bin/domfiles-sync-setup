#!/bin/sh

# shellcheck source=bin/domlib
. "$(dirname "$(realpath "$0")")/domlib"

__print_heading 'Linking domfiles'

for source in .config/fish .gitconfig .vimrc; do
  __symlink "$DOMFILES/$source" "$HOME/$source"
done

if __is_macos && __is_callable pnpm; then
  __symlink "$DOMFILES_NPM_CONFIG_DIR/global.pnpmrc" "$HOME/Library/Preferences/pnpm/rc"
fi

__print_heading_dimmed 'Provisioning additional files'

__touch "$DOMFILES_FISH_CONFIG_DIR/local.fish"
__touch "$DOMFILES_NPM_CONFIG_DIR/user.npmrc"
__touch "$HOME/.hushlogin"
__touch "$HOME/.ssh/.aiexclude"
__mkdir "$DOMFILES_PROJECTS_DIR"

__print_heading_dimmed 'Ensuring proper permissions'

__chmod "$DOMFILES"
__chmod "$HOME/.ssh"

__print_heading_dimmed 'Verifying SSH setup'

if __is_ssh_configured; then
  __print_confirmation "$DOMFILES_SSH_KEY"
else
  __print_error 'No SSH key found'
fi
