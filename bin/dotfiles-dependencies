#!/bin/sh

# shellcheck source=bin/dotlib
. "$(dirname "$(realpath "$0")")/dotlib"

# Check dotfilesâ€™ dependencies
check() {
  dependency_path '$PATH' "$DOTFILES_BIN_DIR"

  dependency_exec 'ssh' '__is_ssh_configured'
  dependency_exec 'brew' '__is_brew_installed'

  dependency_bin 'fish'
  dependency_exec 'fisher' '__is_fisher_installed'

  dependency_bin 'git'
  dependency_bin 'node'
  dependency_bin 'pnpm'

  dependency_bin 'vim'
  dependency_exec 'vim-plug' '__is_vim_plug_installed'
}

dependency_bin() {
  if __is_callable "$1"; then
    __print_success "$1"
  else
    __print_error "$1"
    status=1
  fi
}

dependency_exec() {
  if eval "$2" > /dev/null 2>&1; then
    __print_success "$1"
  else
    __print_error "$1"
    status=1
  fi
}

dependency_path() {
  if echo ":$PATH:" | grep -q ":$2:"; then
    __print_success "$1"
  else
    __print_error "$1"
    status=1
  fi
}

check
exit "${status:-0}"
