#!/bin/sh

# Enable strict mode
set -eu

# Check dotfiles’ dependencies
DOTFILES_BIN_PATH="$(dirname "$(realpath "$0")")"

check() {
  dependency_path "\$PATH" "$DOTFILES_BIN_PATH"

  dependency_bin "brew"

  dependency_bin "fish"
  dependency_exec "fisher" "fish -c 'fisher --version'"

  dependency_bin "git"
  dependency_bin "node"

  dependency_bin "vim"
  dependency_file "vim-plug" "$HOME/.vim/autoload/plug.vim"
}

# Checkers
dependency_bin() {
  if hash "$1" > /dev/null 2>&1; then
    __available "$1"
  else
    __unavailable "$1"
  fi
}

dependency_exec() {
  if eval "$2" > /dev/null 2>&1; then
    __available "$1"
  else
    __unavailable "$1"
  fi
}

dependency_file() {
  if [ -r "$2" ]; then
    __available "$1"
  else
    __unavailable "$1"
  fi
}

dependency_path() {
  if echo ":$PATH:" | grep -q ":$2:"; then
    __available "$1"
  else
    __unavailable "$1"
  fi
}

# Output
__available() {
  printf '\033[0;32m✓ %s\033[0m\n' "$1"
}

__unavailable() {
  printf '\033[1;31m× %s\033[0m\n' "$1"
}

# Init
check
