#!/bin/sh

# shellcheck source=bin/dotlib
. "$(dirname "$(realpath "$0")")/dotlib"

# Check dotfilesâ€™ dependencies
check() {
  dependency_path "\$PATH" "$DOTFILES_BIN_DIR"

  dependency_bin "brew"

  dependency_bin "fish"
  dependency_exec "fisher" "fish -c 'fisher --version'"

  dependency_bin "git"
  dependency_bin "node"

  dependency_bin "vim"
  dependency_file "vim-plug" "$HOME/.vim/autoload/plug.vim"
}

dependency_bin() {
  if hash "$1" > /dev/null 2>&1; then
    __print_success "$1"
  else
    __print_error "$1"
  fi
}

dependency_exec() {
  if eval "$2" > /dev/null 2>&1; then
    __print_success "$1"
  else
    __print_error "$1"
  fi
}

dependency_file() {
  if [ -r "$2" ]; then
    __print_success "$1"
  else
    __print_error "$1"
  fi
}

dependency_path() {
  if echo ":$PATH:" | grep -q ":$2:"; then
    __print_success "$1"
  else
    __print_error "$1"
  fi
}

check
