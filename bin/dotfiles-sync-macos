#!/bin/sh

# shellcheck source=bin/dotlib
. "$(dirname "$(realpath "$0")")/dotlib"

__print_heading 'Configuring macOS'

if ! __is_macos; then
  __print_info_and_exit 'Skipping configuration. This isn’t macOS'
fi

# Enable full keyboard access for all controls
__ defaults write NSGlobalDomain AppleKeyboardUIMode -int 3

# Disable window animations and Get Info animations in Finder
__ defaults write NSGlobalDomain NSAutomaticWindowAnimationsEnabled -bool false
__ defaults write com.apple.finder DisableAllAnimations -bool true

# Show Library in Finder
__ chflags nohidden ~/Library

# Disable font smoothing
__ defaults -currentHost write -g AppleFontSmoothing -int 0

# Disable screenshot thumbnails
__ defaults write com.apple.screencapture show-thumbnail -bool false

# Disable prompt line marks
__ defaults write com.apple.Terminal ShowLineMarks -int 0

# Set Dock icons to a specific size and make hidden applications translucent
__ defaults write com.apple.dock tilesize -int 48
__ defaults write com.apple.dock showhidden -bool true

# Set the consistent clock style on the login screen
__ defaults write com.apple.loginwindow ClockFontIdentifier -string rounded
__ defaults write com.apple.loginwindow ClockFontWeight -int 500

# Disable autoplay in the App Store
__ defaults write com.apple.AppStore AutoPlayVideoSetting -string off
__ defaults write com.apple.AppStore UserSetAutoPlayVideoSetting -int 1

# Don’t prompt for reviews
__ defaults write com.apple.AppStore InAppReviewEnabled -bool false

# Quit the printer app when finished
__ defaults write com.apple.print.PrintingPrefs 'Quit When Finished' -bool true

__print_heading_dimmed 'Restarting affected apps'

__ killall Dock || true
__ killall Finder || true
__ killall SystemUIServer || true
