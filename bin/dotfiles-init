#!/bin/sh

DOTFILES="$HOME/.dotfiles"
DEFAULT_PERMISSIONS=$(stat -f "%A" "$HOME/Library")

# Symlink all dotfiles
symlink() {
  parent=$(dirname "$2")
  mkdir -p "$parent"
  rm -rf "$2"
  ln -s "$1" "$2"
}

for source in .config/fish .gitconfig .hushlogin .local .ssh .vim .vimrc; do
  symlink "$DOTFILES/$source" "$HOME/$source"
done

# Create additional files with proper permissions
permit() {
  chmod "$DEFAULT_PERMISSIONS" "$1"
}

permit "$DOTFILES"
touch "$DOTFILES/extra.sh" && permit "$DOTFILES/extra.sh"
mkdir -p "$HOME/Projects" && permit "$HOME/Projects"

# Apply other dotfiles
"$DOTFILES"/bin/dotfiles-macos
"$DOTFILES"/bin/dotfiles-init-ssh
"$DOTFILES"/bin/dotfiles-init-install
